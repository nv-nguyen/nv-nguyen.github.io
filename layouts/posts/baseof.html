<!DOCTYPE html>
<html lang="{{ $.Site.LanguageCode }}">
    {{- partial "head.html" . -}}
    <body a="{{ $.Site.Params.theme_config.appearance | default "auto" }}">
        <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark/light mode"></button>
        <main class="page-content" aria-label="Content">
            <div class="w">
                {{- block "main" . }}{{- end }}
            </div>
        </main>
        <script>
        (function() {
          var btn = document.getElementById('theme-toggle');
          var body = document.body;

          function getEffectiveTheme() {
            var a = body.getAttribute('a');
            if (a === 'dark' || a === 'light') return a;
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
          }

          function updateButton() {
            btn.textContent = getEffectiveTheme() === 'dark' ? '\u2600\uFE0F' : '\uD83C\uDF19';
          }

          var saved = localStorage.getItem('theme');
          if (saved) body.setAttribute('a', saved);

          updateButton();

          btn.addEventListener('click', function() {
            var next = getEffectiveTheme() === 'dark' ? 'light' : 'dark';
            body.setAttribute('a', next);
            localStorage.setItem('theme', next);
            updateButton();
          });
        })();
        </script>
    </body>
    {{- if .Params.custom_js -}}
        {{- range .Params.custom_js -}}
            {{ $js := resources.Get (print "js/" . ".js") }}
            <script type="text/javascript" src="{{ $js.RelPermalink }}"></script>
        {{- end -}}
    {{- end -}}
</html>
